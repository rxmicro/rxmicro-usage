:FRAGMENT_RELATIVE_DIR: ../../../
include::../../../___fragment-settings.adoc[]

:RX-MICRO-USAGE-ROOT-LOCAL-PATH: ../../../../../../../../

===== Features of REST Client Testing

This section will cover the features of testing REST-based microservices that use REST clients.

The source code of such REST-based microservice consists of the `Response` model class, `ExternalMicroService` REST client and `ConsumeMicroService` HTTP request handler:

[source,java]
----
include::{RX-MICRO-USAGE-ROOT-LOCAL-PATH}examples/group-testing-junit/testing-microservice-alternatives-rest-client/src/main/java/io/rxmicro/examples/testing/microservice/alternatives/rest/client/model/Response.java[tag=content,indent=0]
----

[source,java]
----
include::{RX-MICRO-USAGE-ROOT-LOCAL-PATH}examples/group-testing-junit/testing-microservice-alternatives-rest-client/src/main/java/io/rxmicro/examples/testing/microservice/alternatives/rest/client/ExternalMicroService.java[tag=content,indent=0]
----

[source,java]
----
include::{RX-MICRO-USAGE-ROOT-LOCAL-PATH}examples/group-testing-junit/testing-microservice-alternatives-rest-client/src/main/java/io/rxmicro/examples/testing/microservice/alternatives/rest/client/MicroService.java[tag=content,indent=0]
----

The most logical way to test such microservice is to create a mock alternative for the `ExternalMicroService` component:

[source,java]
----
include::{RX-MICRO-USAGE-ROOT-LOCAL-PATH}examples/group-testing-junit/testing-microservice-alternatives-rest-client/src/test/java/io/rxmicro/examples/testing/microservice/alternatives/rest/client/MicroServiceBusinessLogicOnlyTest.java[tag=content,indent=0]
----

But if on the basis of such test we build the source code coverage report, this report will show a low degree of coverage:

.The test coverage report when using a mock alternative for REST client.
image::testing/microservice/alternative/rest-client/jacoco-business-logic-only.jpg[]

Such a result is caused by the fact that after creating a mock alternative for the `ExternalMicroService` component, the classes generated by the RxMicro framework are not used in the testing process for the REST client work.

If such a result is not acceptable, it is necessary to:

. create a mock alternative to the `HttpClientFactory` RxMicro component;
. use the static methods of the
{RX-MICRO-SRC-ROOT-BLOB-URL}rxmicro-test-mockito/src/main/java/io/rxmicro/test/mockito/httpclient/HttpClientMockFactory.java[`HttpClientMockFactory`^] class to program the mock behavior.

[source,java]
----
include::{RX-MICRO-USAGE-ROOT-LOCAL-PATH}examples/group-testing-junit/testing-microservice-alternatives-rest-client/src/test/java/io/rxmicro/examples/testing/microservice/alternatives/rest/client/MicroServiceWithAllGeneratedCodeTest.java[tag=content,indent=0]
----

The modified test shows a coverage rate of 100%:

.The test coverage report when using the `HttpClientFactory` mock alternative.
image::testing/microservice/alternative/rest-client/jacoco-all-generated.jpg[]

:link: {RX-MICRO-EXAMPLES-SRC-ROOT-TREE-URL}group-testing-junit/testing-microservice-alternatives-rest-client
include::../../../___notes/full-source-code-of-example.adoc[]

include::../../../___notes/recompile-after-change.adoc[]
